<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Super Bot</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>
        body {
            background-color: var(--tg-theme-bg-color, #17212b);
            color: var(--tg-theme-text-color, #ffffff);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            overflow-x: hidden;
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .message-bubble { max-width: 80%; border-radius: 12px; padding: 10px; margin-bottom: 8px; font-size: 14px; }
        .user-msg { background-color: #3390ec; color: white; align-self: flex-end; border-bottom-right-radius: 2px; }
        .ai-msg { background-color: #2b2b2b; color: #e4e4e4; align-self: flex-start; border-bottom-left-radius: 2px; }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ */
        .page-enter { opacity: 0; transform: translateY(10px); animation: fadeInUp 0.3s forwards; }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ID –ê–¥–º–∏–Ω–∞ (–ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ–π ID –∏–∑ Telegram, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –ø–∞–Ω–µ–ª—å)
        // –£–∑–Ω–∞—Ç—å ID –º–æ–∂–Ω–æ –≤ –±–æ—Ç–µ @userinfobot
        const ADMIN_ID = 12345678; 

        const App = () => {
            const [activeTab, setActiveTab] = useState('generate'); // generate, chat, profile, admin
            const [user, setUser] = useState({ first_name: 'Guest', id: 0, username: 'guest' });
            
            // --- –≠–ö–û–ù–û–ú–ò–ö–ê –ò –ù–ê–°–¢–†–û–ô–ö–ò (–£–ø—Ä–∞–≤–ª—è–µ–º—ã–µ –ê–¥–º–∏–Ω–æ–º) ---
            const [config, setConfig] = useState({
                priceImage: 50,
                priceVideo: 300,
                priceText: 10,
                welcomeBonus: 100,
                referralReward: 50,      // –ù–∞–≥—Ä–∞–¥–∞ –∑–∞ –¥—Ä—É–≥–∞
                friendsForReward: 1      // –°–∫–æ–ª—å–∫–∏—Ö –ø—Ä–∏–≥–ª–∞—Å–∏—Ç—å –¥–ª—è –Ω–∞–≥—Ä–∞–¥—ã (–æ–±—ã—á–Ω–æ 1)
            });

            // --- –°–û–°–¢–û–Ø–ù–ò–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø ---
            const [tokens, setTokens] = useState(100);
            const [referrals, setReferrals] = useState(0); // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–Ω—ã—Ö
            const [chatHistory, setChatHistory] = useState([
                { role: 'ai', text: '–ü—Ä–∏–≤–µ—Ç! –Ø Grok AI. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?' }
            ]);

            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            useEffect(() => {
                const tg = window.Telegram.WebApp;
                tg.ready();
                tg.expand();
                
                // 1. –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —é–∑–µ—Ä–∞
                if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                    setUser(tg.initDataUnsafe.user);
                } else {
                    // –î–ª—è —Ç–µ—Å—Ç–∞ –≤ –±—Ä–∞—É–∑–µ—Ä–µ
                    setUser({ first_name: 'Admin Tester', id: ADMIN_ID, username: 'admin' }); 
                }

                // 2. –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–¥–º–∏–Ω–∞ (—Å–∏–º—É–ª—è—Ü–∏—è –ë–î)
                const savedConfig = localStorage.getItem('app_config');
                if (savedConfig) setConfig(JSON.parse(savedConfig));

                // 3. –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                const savedTokens = localStorage.getItem('user_tokens');
                const savedRefs = localStorage.getItem('user_referrals');
                
                if (savedTokens) {
                    setTokens(parseInt(savedTokens));
                } else {
                    // –ï—Å–ª–∏ –Ω–æ–≤—ã–π —é–∑–µ—Ä - –¥–∞–µ–º –±–æ–Ω—É—Å –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞
                    setTokens(JSON.parse(savedConfig || '{}').welcomeBonus || 100);
                }
                if (savedRefs) setReferrals(parseInt(savedRefs));

            }, []);

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏
            useEffect(() => { localStorage.setItem('user_tokens', tokens); }, [tokens]);
            useEffect(() => { localStorage.setItem('user_referrals', referrals); }, [referrals]);
            useEffect(() => { localStorage.setItem('app_config', JSON.stringify(config)); }, [config]);

            // --- –õ–û–ì–ò–ö–ê –ì–ï–ù–ï–†–ê–¶–ò–ò ---
            const [genType, setGenType] = useState('image');
            const [prompt, setPrompt] = useState('');
            const [isProcessing, setIsProcessing] = useState(false);
            const [resultMedia, setResultMedia] = useState(null);

            const handleGenerate = () => {
                const price = genType === 'image' ? config.priceImage : config.priceVideo;
                if (tokens < price) return window.Telegram.WebApp.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤!");
                if (!prompt) return;

                setTokens(t => t - price);
                setIsProcessing(true);
                setResultMedia(null);

                // –ò–º–∏—Ç–∞—Ü–∏—è API
                setTimeout(() => {
                    setIsProcessing(false);
                    if (genType === 'image') setResultMedia(`https://placehold.co/600x600/1a1a1a/FFF.png?text=${encodeURIComponent(prompt)}`);
                    else setResultMedia("https://media.giphy.com/media/l41lI4bYmcsPJX9Nk/giphy.gif");
                    window.Telegram.WebApp.HapticFeedback.notificationOccurred('success');
                }, 2000);
            };

            // --- –õ–û–ì–ò–ö–ê –ß–ê–¢–ê ---
            const [chatInput, setChatInput] = useState('');
            const chatEndRef = useRef(null);

            const handleSendChat = () => {
                if (tokens < config.priceText) return window.Telegram.WebApp.showAlert("–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤ –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞!");
                if (!chatInput.trim()) return;

                setTokens(t => t - config.priceText);
                const userMsg = { role: 'user', text: chatInput };
                setChatHistory(prev => [...prev, userMsg]);
                setChatInput('');
                
                // –ò–º–∏—Ç–∞—Ü–∏—è –æ—Ç–≤–µ—Ç–∞
                setTimeout(() => {
                    const aiMsg = { role: 'ai', text: `–ì—Ä–æ–∫ –¥—É–º–∞–µ—Ç, —á—Ç–æ "${userMsg.text}" - —ç—Ç–æ –æ—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å! (–≠—Ç–æ –¥–µ–º–æ-–æ—Ç–≤–µ—Ç)` };
                    setChatHistory(prev => [...prev, aiMsg]);
                    window.Telegram.WebApp.HapticFeedback.impactOccurred('light');
                }, 1000);
            };
            
            useEffect(() => { chatEndRef.current?.scrollIntoView({ behavior: "smooth" }); }, [chatHistory]);

            // --- –õ–û–ì–ò–ö–ê –†–ï–§–ï–†–ê–õ–û–í ---
            const inviteLink = `https://t.me/YourBotName?start=${user.id}`;
            const copyLink = () => {
                navigator.clipboard.writeText(inviteLink);
                window.Telegram.WebApp.showAlert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!");
            };
            
            // –°–∏–º—É–ª—è—Ü–∏—è –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è –¥—Ä—É–≥–∞ (–¥–ª—è —Ç–µ—Å—Ç–∞)
            const simInvite = () => {
                setReferrals(r => r + 1);
                // –ï—Å–ª–∏ –¥–æ—Å—Ç–∏–≥–ª–∏ –ø–æ—Ä–æ–≥–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∫–∞–∂–¥—ã–π 1 –¥—Ä—É–≥), –¥–∞–µ–º –Ω–∞–≥—Ä–∞–¥—É
                if ((referrals + 1) % config.friendsForReward === 0) {
                    setTokens(t => t + config.referralReward);
                    window.Telegram.WebApp.showAlert(`–î—Ä—É–≥ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è! +${config.referralReward} —Ç–æ–∫–µ–Ω–æ–≤`);
                }
            };

            // ================= –ö–û–ú–ü–û–ù–ï–ù–¢–´ =================

            const TabGenerate = () => (
                <div className="page-enter p-4 pb-24">
                    <div className="flex bg-gray-800 rounded-lg p-1 mb-6">
                        <button onClick={() => setGenType('image')} className={`flex-1 py-2 rounded text-sm font-bold ${genType === 'image' ? 'bg-blue-600' : 'text-gray-400'}`}>–ö–∞—Ä—Ç–∏–Ω–∫–∞ ({config.priceImage}—Ç)</button>
                        <button onClick={() => setGenType('video')} className={`flex-1 py-2 rounded text-sm font-bold ${genType === 'video' ? 'bg-purple-600' : 'text-gray-400'}`}>–í–∏–¥–µ–æ ({config.priceVideo}—Ç)</button>
                    </div>

                    <textarea 
                        value={prompt} onChange={e => setPrompt(e.target.value)}
                        placeholder={genType === 'image' ? "–ù–∞–ø—Ä–∏–º–µ—Ä: –ö–æ—Ç –≤ –∫–æ—Å–º–æ—Å–µ..." : "–ù–∞–ø—Ä–∏–º–µ—Ä: –ü–æ–ª–µ—Ç –Ω–∞–¥ –≥–æ—Ä–∞–º–∏..."}
                        className="w-full bg-gray-800 rounded-xl p-4 mb-4 text-white min-h-[120px] border border-gray-700 focus:border-blue-500 outline-none"
                    ></textarea>

                    <button onClick={handleGenerate} disabled={isProcessing} className="w-full bg-gradient-to-r from-blue-600 to-blue-500 py-4 rounded-xl font-bold shadow-lg active:scale-95 transition-transform flex justify-center items-center">
                        {isProcessing ? <i className="fas fa-spinner fa-spin"></i> : <span>üöÄ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</span>}
                    </button>

                    {resultMedia && (
                        <div className="mt-6 rounded-xl overflow-hidden border border-gray-700 animate-fade-in">
                            <img src={resultMedia} className="w-full" alt="Result" />
                        </div>
                    )}
                </div>
            );

            const TabChat = () => (
                <div className="page-enter flex flex-col h-[calc(100vh-80px)]">
                    <div className="flex-1 overflow-y-auto p-4 space-y-3">
                        {chatHistory.map((msg, idx) => (
                            <div key={idx} className={`flex flex-col ${msg.role === 'user' ? 'items-end' : 'items-start'}`}>
                                <div className={`message-bubble ${msg.role === 'user' ? 'user-msg' : 'ai-msg'}`}>
                                    {msg.text}
                                </div>
                            </div>
                        ))}
                        <div ref={chatEndRef} />
                    </div>
                    <div className="p-3 bg-gray-900 border-t border-gray-800 flex items-center gap-2">
                        <input 
                            value={chatInput} onChange={e => setChatInput(e.target.value)}
                            placeholder={`–°–ø—Ä–æ—Å–∏ (${config.priceText} —Ç–æ–∫)...`}
                            className="flex-1 bg-gray-800 text-white rounded-full px-4 py-2 outline-none border border-gray-700"
                        />
                        <button onClick={handleSendChat} className="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center text-white active:scale-90 transition">
                            <i className="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            );

            const TabProfile = () => (
                <div className="page-enter p-4 pb-24">
                    <div className="bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-6 mb-6 border border-gray-700">
                        <div className="flex justify-between items-start mb-4">
                            <div>
                                <h2 className="text-xl font-bold">{user.first_name}</h2>
                                <p className="text-gray-400 text-sm">@{user.username || 'user'}</p>
                            </div>
                            <div className="text-right">
                                <span className="block text-3xl font-bold text-yellow-500">{tokens}</span>
                                <span className="text-xs text-gray-400">TOKENS</span>
                            </div>
                        </div>
                        
                        {/* –ö–Ω–æ–ø–∫–∞ –ê–¥–º–∏–Ω–∞ (–≤–∏–¥–Ω–∞ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ ID —Å–æ–≤–ø–∞–¥–∞–µ—Ç) */}
                        {user.id === ADMIN_ID && (
                            <button onClick={() => setActiveTab('admin')} className="w-full bg-red-900/50 text-red-200 py-2 rounded-lg text-sm mb-4 border border-red-800">
                                <i className="fas fa-cogs mr-2"></i> –ü–∞–Ω–µ–ª—å –ê–¥–º–∏–Ω–∞
                            </button>
                        )}
                        
                        <div className="grid grid-cols-2 gap-3">
                            <div className="bg-gray-800/50 p-3 rounded-xl text-center">
                                <i className="fas fa-image text-blue-400 mb-1"></i>
                                <p className="text-xs text-gray-400">–ì–µ–Ω–µ—Ä–∞—Ü–∏–π</p>
                                <p className="font-bold">0</p>
                            </div>
                            <div className="bg-gray-800/50 p-3 rounded-xl text-center">
                                <i className="fas fa-users text-green-400 mb-1"></i>
                                <p className="text-xs text-gray-400">–î—Ä—É–∑–µ–π</p>
                                <p className="font-bold">{referrals}</p>
                            </div>
                        </div>
                    </div>

                    <div className="bg-gray-800 rounded-2xl p-6 border border-gray-700">
                        <h3 className="font-bold mb-2 flex items-center">
                            <i className="fas fa-gift text-pink-500 mr-2"></i> –ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–≥–∞
                        </h3>
                        <p className="text-sm text-gray-400 mb-4">
                            –ü–æ–ª—É—á–∏ <b>{config.referralReward} —Ç–æ–∫–µ–Ω–æ–≤</b> –∑–∞ –∫–∞–∂–¥–æ–≥–æ {config.friendsForReward}-–≥–æ –¥—Ä—É–≥–∞!
                        </p>
                        
                        <div className="bg-black/30 p-3 rounded-lg flex items-center justify-between mb-4">
                            <code className="text-xs text-blue-300 truncate max-w-[200px]">{inviteLink}</code>
                            <button onClick={copyLink} className="text-white bg-blue-600 px-3 py-1 rounded text-xs font-bold">
                                –ö–æ–ø–∏—è
                            </button>
                        </div>
                        
                        <button onClick={simInvite} className="w-full border border-dashed border-gray-600 py-2 rounded text-xs text-gray-500 hover:text-white">
                            (–¢–µ—Å—Ç) –°–∏–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –≤—Ö–æ–¥ –¥—Ä—É–≥–∞
                        </button>
                    </div>
                </div>
            );

            const TabAdmin = () => (
                <div className="page-enter p-4 pb-24">
                    <div className="flex items-center mb-6">
                        <button onClick={() => setActiveTab('profile')} className="mr-4 text-gray-400"><i className="fas fa-arrow-left"></i></button>
                        <h2 className="text-xl font-bold text-red-400">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ë–æ—Ç–∞</h2>
                    </div>

                    <div className="space-y-4">
                        <div className="bg-gray-800 p-4 rounded-xl border border-gray-700">
                            <h3 className="text-sm font-bold text-gray-400 mb-3 uppercase">–¢–∞—Ä–∏—Ñ—ã (–¢–æ–∫–µ–Ω—ã)</h3>
                            
                            <div className="grid grid-cols-2 gap-4 mb-3">
                                <div>
                                    <label className="text-xs text-gray-500">–ö–∞—Ä—Ç–∏–Ω–∫–∞</label>
                                    <input type="number" value={config.priceImage} onChange={e => setConfig({...config, priceImage: Number(e.target.value)})} className="w-full bg-gray-900 rounded p-2 text-white border border-gray-700"/>
                                </div>
                                <div>
                                    <label className="text-xs text-gray-500">–í–∏–¥–µ–æ</label>
                                    <input type="number" value={config.priceVideo} onChange={e => setConfig({...config, priceVideo: Number(e.target.value)})} className="w-full bg-gray-900 rounded p-2 text-white border border-gray-700"/>
                                </div>
                            </div>
                            <div>
                                <label className="text-xs text-gray-500">–¢–µ–∫—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å (AI —á–∞—Ç)</label>
                                <input type="number" value={config.priceText} onChange={e => setConfig({...config, priceText: Number(e.target.value)})} className="w-full bg-gray-900 rounded p-2 text-white border border-gray-700"/>
                            </div>
                        </div>

                        <div className="bg-gray-800 p-4 rounded-xl border border-gray-700">
                            <h3 className="text-sm font-bold text-gray-400 mb-3 uppercase">–ú–∞—Ä–∫–µ—Ç–∏–Ω–≥</h3>
                            
                            <div className="mb-3">
                                <label className="text-xs text-gray-500">–ë–æ–Ω—É—Å –∑–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é</label>
                                <input type="number" value={config.welcomeBonus} onChange={e => setConfig({...config, welcomeBonus: Number(e.target.value)})} className="w-full bg-gray-900 rounded p-2 text-white border border-gray-700"/>
                            </div>
                            
                            <div className="grid grid-cols-2 gap-4">
                                <div>
                                    <label className="text-xs text-gray-500">–ù–∞–≥—Ä–∞–¥–∞ –∑–∞ –¥—Ä—É–≥–∞</label>
                                    <input type="number" value={config.referralReward} onChange={e => setConfig({...config, referralReward: Number(e.target.value)})} className="w-full bg-gray-900 rounded p-2 text-white border border-gray-700"/>
                                </div>
                                <div>
                                    <label className="text-xs text-gray-500">–¶–µ–ª—å (–∫–æ–ª-–≤–æ –¥—Ä—É–∑–µ–π)</label>
                                    <input type="number" value={config.friendsForReward} onChange={e => setConfig({...config, friendsForReward: Number(e.target.value)})} className="w-full bg-gray-900 rounded p-2 text-white border border-gray-700"/>
                                </div>
                            </div>
                        </div>

                        <div className="bg-green-900/30 p-4 rounded-xl border border-green-800">
                            <p className="text-sm text-green-200"><i className="fas fa-save mr-2"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.</p>
                        </div>
                    </div>
                </div>
            );

            // –ù–∏–∂–Ω–µ–µ –º–µ–Ω—é
            const NavItem = ({ id, icon, label }) => (
                <button 
                    onClick={() => setActiveTab(id)}
                    className={`flex flex-col items-center space-y-1 w-16 transition-all ${activeTab === id ? 'text-blue-500 scale-110' : 'text-gray-500'}`}
                >
                    <i className={`fas ${icon} text-xl`}></i>
                    <span className="text-[10px] font-medium">{label}</span>
                </button>
            );

            return (
                <div className="min-h-screen bg-[#17212b]">
                    {activeTab === 'generate' && <TabGenerate />}
                    {activeTab === 'chat' && <TabChat />}
                    {activeTab === 'profile' && <TabProfile />}
                    {activeTab === 'admin' && <TabAdmin />}

                    {/* –ù–∞–≤–∏–≥–∞—Ü–∏—è */}
                    <div className="fixed bottom-0 left-0 right-0 bg-[#1c2936] border-t border-gray-800 pb-safe pt-2 px-6 flex justify-around z-40 h-[70px]">
                        <NavItem id="generate" icon="fa-wand-magic-sparkles" label="–ò–º–∏–¥–∂" />
                        <NavItem id="chat" icon="fa-comments" label="–ß–∞—Ç" />
                        <NavItem id="profile" icon="fa-user-astronaut" label="–ü—Ä–æ—Ñ–∏–ª—å" />
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>


