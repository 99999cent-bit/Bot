<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI Bot</title>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">

    <style>
        body {
            background-color: var(--tg-theme-bg-color, #17212b);
            color: var(--tg-theme-text-color, #ffffff);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            /* –£–±–∏—Ä–∞–µ–º overflow:hidden –¥–ª—è body, —á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞–ª —Å–∫—Ä–æ–ª–ª —Å—Ç—Ä–∞–Ω–∏—Ü—ã */
            min-height: 100vh;
            padding-bottom: 90px; /* –ú–µ—Å—Ç–æ –¥–ª—è –Ω–∏–∂–Ω–µ–≥–æ –º–µ–Ω—é */
        }
        
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        
        .message-bubble { max-width: 85%; border-radius: 16px; padding: 12px; margin-bottom: 8px; font-size: 15px; line-height: 1.4; word-wrap: break-word; }
        .user-msg { background-color: #3390ec; color: white; align-self: flex-end; border-bottom-right-radius: 4px; }
        .ai-msg { background-color: #2b2b2b; color: #e4e4e4; align-self: flex-start; border-bottom-left-radius: 4px; }
        
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        .page-enter { opacity: 0; animation: fadeIn 0.3s forwards; }
        @keyframes fadeIn { to { opacity: 1; } }
        .slide-down { animation: slideDown 0.4s ease-out; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }

        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); z-index: 100; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-content { background: #1c2936; padding: 20px; border-radius: 20px; width: 90%; max-width: 350px; text-align: center; border: 1px solid #3390ec; }
        
        .tariff-card { background: linear-gradient(145deg, #2b3c4e, #1c2936); border: 1px solid #334e68; transition: transform 0.1s; position: relative; overflow: hidden; }
        .tariff-card:active { transform: scale(0.98); }

        .media-card { background: #1c2936; border-radius: 16px; overflow: hidden; margin-top: 16px; border: 1px solid #2b3c4e; }
        .media-actions { display: flex; border-top: 1px solid #2b3c4e; }
        .media-btn { flex: 1; padding: 12px; text-align: center; color: #3390ec; font-weight: bold; font-size: 14px; background: rgba(255,255,255,0.02); }
        .media-btn:active { background: rgba(255,255,255,0.05); }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
        import { 
            getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot, increment, arrayUnion, collection, getDocs, query, where 
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // –¢–í–û–ô –ö–û–ù–§–ò–ì
        const firebaseConfig = {
            apiKey: "AIzaSyCbzbhEn__nA9TXawnqRVU2DbZFyeJa_2U",
            authDomain: "aigenerator75-3fb8e.firebaseapp.com",
            projectId: "aigenerator75-3fb8e",
            storageBucket: "aigenerator75-3fb8e.firebasestorage.app",
            messagingSenderId: "1018038849306",
            appId: "1:1018038849306:web:462e241a3940ff591ee6a3",
            measurementId: "G-W8TPE5PLEF"
        };

        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const db = getFirestore(app);

        // –≠–∫—Å–ø–æ—Ä—Ç –≤ –≥–ª–æ–±–∞–ª—å–Ω—É—é –æ–±–ª–∞—Å—Ç—å –¥–ª—è React
        window.db = db;
        window.fs = { doc, getDoc, setDoc, updateDoc, onSnapshot, increment, arrayUnion, collection, getDocs, query, where };
        window.firebaseReady = true;
        document.dispatchEvent(new Event('firebase-ready'));
    </script>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;
        
        // ! –í–ê–ñ–ù–û: ID –ê–¥–º–∏–Ω–∞
        const ADMIN_ID = 442529744; 

        const App = () => {
            const [activeTab, setActiveTab] = useState('generate');
            const [user, setUser] = useState(null);
            const [isLoading, setIsLoading] = useState(true);
            
            // –ì–ª–æ–±–∞–ª—å–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è (—á—Ç–æ–±—ã –Ω–µ –ø—Ä–æ–ø–∞–¥–∞–ª–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ –≤–∫–ª–∞–¥–æ–∫)
            // { id, type: 'image'|'video', url, prompt, date }
            const [globalHistory, setGlobalHistory] = useState([]);

            const [payModalData, setPayModalData] = useState(null);
            const [shareModalItem, setShareModalItem] = useState(null);

            const [dbUser, setDbUser] = useState({ balance: 0, referrals: 0, firstName: '', spent: 0 });
            
            const [config, setConfig] = useState({
                priceImage: 50, priceVideo: 300, priceText: 10,
                welcomeBonus: 100, referralReward: 50,
                tokenPriceRub: 1.0, 
                paymentLink: "https://yoomoney.ru", 
                qrUrl: "https://upload.wikimedia.org/wikipedia/commons/d/d0/QR_code_for_mobile_English_Wikipedia.svg",
                tariffs: [
                    { id: 1, name: 'üöÄ –°—Ç–∞—Ä—Ç', tokens: 100, price: 99 },
                    { id: 2, name: 'üíé –ü—Ä–æ—Ñ–∏', tokens: 500, price: 450 },
                    { id: 3, name: 'üëë –û–ª–∏–≥–∞—Ä—Ö', tokens: 1000, price: 800 }
                ]
            });

            const [chatHistory, setChatHistory] = useState([
                { role: 'ai', text: '–ü—Ä–∏–≤–µ—Ç! –Ø AI Bot. –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?' }
            ]);

            useEffect(() => {
                const initApp = async () => {
                    const tg = window.Telegram.WebApp;
                    tg.ready();
                    tg.expand();

                    let telegramUser = tg.initDataUnsafe?.user;
                    if (!telegramUser) telegramUser = { id: ADMIN_ID, first_name: 'Dev', username: 'dev' };
                    
                    setUser(telegramUser);
                    
                    if (!window.firebaseReady) {
                        await new Promise(resolve => document.addEventListener('firebase-ready', resolve));
                    }

                    const { doc, getDoc, setDoc, updateDoc, onSnapshot, increment } = window.fs;
                    const db = window.db;

                    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                    const configRef = doc(db, "settings", "global");
                    onSnapshot(configRef, (snap) => {
                        if (snap.exists()) setConfig(prev => ({ ...prev, ...snap.data() }));
                        else setDoc(configRef, config);
                    });

                    // –Æ–∑–µ—Ä
                    const userRef = doc(db, "users", telegramUser.id.toString());
                    const userSnap = await getDoc(userRef);

                    if (!userSnap.exists()) {
                        const startParam = tg.initDataUnsafe?.start_param; 
                        await setDoc(userRef, {
                            username: telegramUser.username || '',
                            firstName: telegramUser.first_name || 'User',
                            balance: config.welcomeBonus || 100,
                            referrals: 0,
                            spent: 0,
                            invitedBy: startParam || null,
                            createdAt: new Date().toISOString()
                        });

                        if (startParam && startParam != telegramUser.id) {
                            const refUserRef = doc(db, "users", startParam.toString());
                            updateDoc(refUserRef, {
                                referrals: increment(1),
                                balance: increment(config.referralReward || 50) 
                            }).catch(e => console.log("Ref error"));
                        }
                    }

                    onSnapshot(userRef, (snap) => {
                        if (snap.exists()) setDbUser(snap.data());
                    });

                    setIsLoading(false);
                };
                initApp();
            }, []);

            // --- –§—É–Ω–∫—Ü–∏–∏ ---
            const saveConfigToDb = async (newConfig) => {
                const { updateDoc, doc } = window.fs;
                await updateDoc(doc(window.db, "settings", "global"), newConfig);
                window.Telegram.WebApp.showAlert("–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!");
            };

            const handleGenerateAction = async (price) => {
                if (user.id === ADMIN_ID) return true;
                if (dbUser.balance < price) {
                    window.Telegram.WebApp.showAlert(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–∫–µ–Ω–æ–≤! –ù—É–∂–Ω–æ ${price}`);
                    return false;
                }
                await window.fs.updateDoc(window.fs.doc(window.db, "users", user.id.toString()), { balance: window.fs.increment(-price) });
                return true; 
            };

            // –§–£–ù–ö–¶–ò–Ø –°–ö–ê–ß–ò–í–ê–ù–ò–Ø
            const downloadMedia = async (url, filename) => {
                const tg = window.Telegram.WebApp;
                tg.HapticFeedback.impactOccurred('medium');
                
                try {
                    // –ü—ã—Ç–∞–µ–º—Å—è —Å–∫–∞—á–∞—Ç—å —Ñ–∞–π–ª –≤–Ω—É—Ç—Ä—å –±—Ä–∞—É–∑–µ—Ä–∞
                    const response = await fetch(url);
                    const blob = await response.blob();
                    const blobUrl = window.URL.createObjectURL(blob);
                    
                    // –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é —Å—Å—ã–ª–∫—É
                    const link = document.createElement('a');
                    link.href = blobUrl;
                    link.download = filename; // –ò–º—è —Ñ–∞–π–ª–∞ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    setTimeout(() => window.URL.revokeObjectURL(blobUrl), 100);
                } catch (e) {
                    // –ï—Å–ª–∏ –Ω–µ –≤—ã—à–ª–æ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–ª–∏—Ç–∏–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏), –æ—Ç–∫—Ä—ã–≤–∞–µ–º –≤ –Ω–æ–≤–æ–º –æ–∫–Ω–µ
                    tg.openLink(url);
                }
            };

            const shareMedia = async (item) => {
                if (navigator.share) {
                    try {
                        await navigator.share({
                            title: 'AI Generator',
                            text: `–°–º–æ—Ç—Ä–∏, —á—Ç–æ —è —Å–æ–∑–¥–∞–ª: ${item.prompt}`,
                            url: item.url
                        });
                    } catch (e) { console.log(e); }
                } else {
                    navigator.clipboard.writeText(item.url);
                    window.Telegram.WebApp.showAlert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!");
                }
            };

            // --- –ö–û–ú–ü–û–ù–ï–ù–¢–´ –í–ö–õ–ê–î–û–ö ---

            const TabGenerate = () => {
                const [genType, setGenType] = useState('image'); // 'image' | 'video'
                const [prompt, setPrompt] = useState('');
                const [isProc, setIsProc] = useState(false);

                const go = async () => {
                    if (!prompt) return;
                    const price = genType === 'image' ? config.priceImage : config.priceVideo;
                    setIsProc(true);
                    
                    const success = await handleGenerateAction(price);
                    if (success) {
                        setTimeout(() => {
                            setIsProc(false);
                            // –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–±–∏–ª—å–Ω—ã–µ URL –¥–ª—è —Ç–µ—Å—Ç–∞
                            const newUrl = genType === 'image' 
                                ? `https://placehold.co/600x600/1a1a1a/FFF.png?text=${encodeURIComponent(prompt)}` 
                                : "https://www.w3schools.com/html/mov_bbb.mp4";
                            
                            const newItem = {
                                id: Date.now(),
                                type: genType,
                                url: newUrl,
                                prompt: prompt,
                                date: new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})
                            };
                            setGlobalHistory(prev => [newItem, ...prev]);
                            window.Telegram.WebApp.HapticFeedback.notificationOccurred('success');
                        }, 2500);
                    } else {
                        setIsProc(false);
                    }
                };

                // –§–∏–ª—å—Ç—Ä—É–µ–º –∏—Å—Ç–æ—Ä–∏—é: –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –≤—ã–±—Ä–∞–Ω–æ –≤ –∫–Ω–æ–ø–∫–∞—Ö
                const filteredHistory = globalHistory.filter(item => item.type === genType);

                return (
                    <div className="page-enter p-5">
                        <div className="flex justify-between mb-4">
                            <span className="text-gray-400">–ë–∞–ª–∞–Ω—Å: <b className="text-yellow-400">{user.id === ADMIN_ID ? '‚àû (Admin)' : dbUser.balance}</b></span>
                        </div>
                        <div className="flex bg-gray-800 rounded-lg p-1 mb-4">
                            <button onClick={() => setGenType('image')} className={`flex-1 py-2 rounded font-bold text-sm transition-all ${genType === 'image' ? 'bg-blue-600 shadow-lg' : 'text-gray-500'}`}>–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ ({config.priceImage})</button>
                            <button onClick={() => setGenType('video')} className={`flex-1 py-2 rounded font-bold text-sm transition-all ${genType === 'video' ? 'bg-purple-600 shadow-lg' : 'text-gray-500'}`}>–í–∏–¥–µ–æ ({config.priceVideo})</button>
                        </div>
                        <textarea value={prompt} onChange={e => setPrompt(e.target.value)} placeholder={`–û–ø–∏—à–∏ ${genType === 'image' ? '–∫–∞—Ä—Ç–∏–Ω–∫—É' : '–≤–∏–¥–µ–æ'}...`} className="w-full bg-gray-800 rounded-xl p-4 mb-4 text-white min-h-[100px] border border-gray-700 focus:border-blue-500 outline-none"></textarea>
                        <button onClick={go} disabled={isProc} className={`w-full py-3 rounded-xl font-bold shadow-lg active:scale-95 transition-all ${genType === 'image' ? 'bg-blue-600' : 'bg-purple-600'}`}>
                            {isProc ? <i className="fas fa-spinner fa-spin"></i> : "üöÄ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å"}
                        </button>
                        
                        <div className="mt-6 space-y-4">
                            {filteredHistory.length === 0 && globalHistory.length > 0 && (
                                <div className="text-center text-gray-500 text-sm py-4">–í —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–∫–∞ –ø—É—Å—Ç–æ</div>
                            )}
                            
                            {filteredHistory.map(item => (
                                <div key={item.id} className="media-card slide-down">
                                    <div className="p-3 bg-[#233040] border-b border-[#2b3c4e] flex justify-between items-center">
                                        <span className="text-xs text-gray-400 truncate max-w-[70%]">{item.prompt}</span>
                                        <span className="text-[10px] text-gray-500">{item.date}</span>
                                    </div>
                                    <div className="bg-black flex justify-center items-center min-h-[200px]">
                                        {item.type === 'image' ? (
                                            <img src={item.url} className="max-w-full max-h-[400px] object-contain" alt="Gen" />
                                        ) : (
                                            <video src={item.url} controls className="max-w-full max-h-[400px]" />
                                        )}
                                    </div>
                                    <div className="media-actions">
                                        <button onClick={() => downloadMedia(item.url, `${item.type}_${item.id}.${item.type==='image'?'png':'mp4'}`)} className="media-btn border-r border-[#2b3c4e]">
                                            <i className="fas fa-file-download mr-2"></i> –°–∫–∞—á–∞—Ç—å
                                        </button>
                                        <button onClick={() => setShareModalItem(item)} className="media-btn">
                                            <i className="fas fa-share-nodes mr-2"></i> –ü–æ–¥–µ–ª–∏—Ç—å—Å—è
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                );
            };

            const TabChat = () => {
                const [txt, setTxt] = useState('');
                const endRef = useRef(null);

                const send = async () => {
                    if (!txt.trim()) return;
                    const success = await handleGenerateAction(config.priceText);
                    if (success) {
                        setChatHistory(prev => [...prev, { role: 'user', text: txt }]);
                        const q = txt; 
                        setTxt('');
                        setTimeout(() => {
                            setChatHistory(prev => [...prev, { role: 'ai', text: `–û—Ç–≤–µ—Ç –Ω–∞: ${q}` }]);
                        }, 800);
                    }
                };

                useEffect(() => { endRef.current?.scrollIntoView({ behavior: "smooth" }); }, [chatHistory]);

                return (
                    <div className="flex flex-col h-full relative" style={{height: 'calc(100vh - 90px)'}}>
                        <div className="flex-1 overflow-y-auto p-4 space-y-3">
                            {chatHistory.map((m, i) => (
                                <div key={i} className={`flex ${m.role === 'user' ? 'justify-end' : 'justify-start'}`}>
                                    <div className={`message-bubble ${m.role === 'user' ? 'user-msg' : 'ai-msg'}`}>{m.text}</div>
                                </div>
                            ))}
                            <div ref={endRef} />
                        </div>
                        <div className="bg-[#17212b] p-3 border-t border-gray-800 flex items-center gap-2 shrink-0">
                            <input value={txt} onChange={e => setTxt(e.target.value)} placeholder={`–í–æ–ø—Ä–æ—Å (${user.id === ADMIN_ID ? 0 : config.priceText} —Ç)...`} className="flex-1 bg-gray-800 text-white rounded-full px-4 py-3 outline-none border border-gray-600 focus:border-blue-500"/>
                            <button onClick={send} className="w-12 h-12 rounded-full bg-blue-600 text-white flex items-center justify-center shadow-lg"><i className="fas fa-paper-plane"></i></button>
                        </div>
                    </div>
                );
            };

            const TabProfile = () => {
                const link = `https://99999cent-bit.github.io/Bot/?start=${user.id}`;
                const [buyAmount, setBuyAmount] = useState(100);
                const totalPrice = Math.ceil(buyAmount * config.tokenPriceRub);

                return (
                    <div className="page-enter p-5">
                        <div className="bg-gradient-to-br from-gray-800 to-gray-900 rounded-2xl p-6 mb-4 border border-gray-700 shadow-lg">
                            <div className="flex justify-between items-start mb-4">
                                <div>
                                    {/* –ò–°–ü–†–ê–í–õ–ï–ù –¶–í–ï–¢ –ò–ú–ï–ù–ò –ù–ê –ë–ï–õ–´–ô */}
                                    <h2 className="text-2xl font-bold text-white">{user.first_name}</h2>
                                    <p className="text-gray-400 text-sm">ID: {user.id}</p>
                                </div>
                                <div className="text-right">
                                    <span className="block text-4xl font-bold text-yellow-400">{user.id === ADMIN_ID ? '‚àû' : dbUser.balance}</span>
                                    <span className="text-xs text-gray-400 uppercase tracking-wider">–¢–æ–∫–µ–Ω–æ–≤</span>
                                </div>
                            </div>
                            {user.id === ADMIN_ID && (
                                <button onClick={() => setActiveTab('admin')} className="w-full bg-gray-700 py-2 rounded-xl font-medium text-sm border border-gray-600 mb-2"><i className="fas fa-cog mr-2"></i> –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å</button>
                            )}
                        </div>

                        <h3 className="text-lg font-bold mb-3 pl-1 text-white">üì¶ –ü–∞–∫–µ—Ç—ã</h3>
                        <div className="grid gap-3 mb-6">
                            {(config.tariffs || []).map(tariff => (
                                <div key={tariff.id} className="tariff-card rounded-xl p-4 flex justify-between items-center cursor-pointer" 
                                     onClick={() => setPayModalData({name: tariff.name, tokens: tariff.tokens, price: tariff.price})}>
                                    <div className="flex items-center">
                                        <div className="bg-blue-600/20 text-blue-400 w-10 h-10 rounded-full flex items-center justify-center mr-3"><i className="fas fa-bolt"></i></div>
                                        <div>
                                            <div className="font-bold text-base text-white">{tariff.name}</div>
                                            <div className="text-gray-400 text-xs">{tariff.tokens} —Ç–æ–∫–µ–Ω–æ–≤</div>
                                        </div>
                                    </div>
                                    <div className="bg-blue-600 px-3 py-1.5 rounded-lg font-bold text-sm text-white shadow">{tariff.price} ‚ÇΩ</div>
                                </div>
                            ))}
                        </div>

                        <div className="bg-gray-800 rounded-2xl p-5 border border-gray-700 mb-4">
                            <h3 className="font-bold text-lg mb-3 text-white"><i className="fas fa-calculator text-gray-400 mr-2"></i>–°–≤–æ–π –≤–∞—Ä–∏–∞–Ω—Ç</h3>
                            <div className="mb-4">
                                <label className="text-xs text-gray-400 mb-1 block">–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (–º–∏–Ω–∏–º—É–º 100):</label>
                                <div className="flex items-center bg-gray-900 rounded-xl border border-gray-600 overflow-hidden">
                                    <input type="number" value={buyAmount} onChange={e => setBuyAmount(Math.max(1, Number(e.target.value)))} className="flex-1 bg-transparent p-3 text-white outline-none font-mono"/>
                                    <span className="pr-4 text-gray-500 text-sm">—à—Ç.</span>
                                </div>
                                <p className="text-xs text-gray-500 mt-2">–ö—É—Ä—Å: 1 —Ç–æ–∫–µ–Ω = {config.tokenPriceRub} ‚ÇΩ</p>
                            </div>
                            <button onClick={() => {
                                if(buyAmount<100) return window.Telegram.WebApp.showAlert("–ú–∏–Ω–∏–º—É–º 100!");
                                setPayModalData({name: '–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ', tokens: buyAmount, price: totalPrice});
                            }} className="w-full bg-green-600 hover:bg-green-500 py-3 rounded-xl font-bold shadow-lg flex justify-center items-center">
                                <span>–ö—É–ø–∏—Ç—å –∑–∞ {totalPrice} ‚ÇΩ</span>
                            </button>
                        </div>

                        <div className="bg-gray-800 rounded-2xl p-5 border border-gray-700">
                            <h3 className="font-bold text-lg mb-2 text-white">üéÅ –†–µ—Ñ–µ—Ä–∞–ª–∫–∞</h3>
                            <p className="text-sm text-gray-300 mb-4">–ù–∞–≥—Ä–∞–¥–∞: <b className="text-yellow-400">{config.referralReward} —Ç–æ–∫–µ–Ω–æ–≤</b></p>
                            <div className="flex gap-2">
                                <div className="bg-black/40 p-3 rounded-lg flex-1 overflow-hidden"><p className="text-xs text-gray-400 truncate">{link}</p></div>
                                <button onClick={() => {navigator.clipboard.writeText(link); window.Telegram.WebApp.showAlert("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!");}} className="bg-blue-600 px-4 rounded-lg font-bold text-sm">–ö–æ–ø–∏—è</button>
                            </div>
                        </div>
                    </div>
                );
            };

            const TabAdmin = () => {
                const [subTab, setSubTab] = useState('settings'); 
                const [localConfig, setLocalConfig] = useState(config);
                const [grantId, setGrantId] = useState('');
                const [grantAmount, setGrantAmount] = useState('');

                const handleChange = (field, val) => setLocalConfig(prev => ({ ...prev, [field]: val }));
                const save = () => saveConfigToDb(localConfig);

                const handleGrant = async () => {
                    if(!grantId || !grantAmount) return;
                    try {
                        const ref = window.fs.doc(window.db, "users", grantId);
                        await window.fs.updateDoc(ref, { balance: window.fs.increment(Number(grantAmount)) });
                        window.Telegram.WebApp.showAlert("–ù–∞—á–∏—Å–ª–µ–Ω–æ!");
                        setGrantId(''); setGrantAmount('');
                    } catch(e) { window.Telegram.WebApp.showAlert("–û—à–∏–±–∫–∞ (–Ω–µ—Ç —é–∑–µ—Ä–∞?)"); }
                };

                return (
                    <div className="page-enter p-5">
                        <div className="flex items-center justify-between mb-4">
                            <button onClick={() => setActiveTab('profile')} className="text-gray-400 flex items-center"><i className="fas fa-arrow-left mr-2"></i> –ù–∞–∑–∞–¥</button>
                            <div className="bg-gray-800 rounded-lg p-1 flex">
                                <button onClick={() => setSubTab('settings')} className={`px-3 py-1 rounded text-xs font-bold ${subTab==='settings'?'bg-blue-600':'text-gray-500'}`}>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
                                <button onClick={() => setSubTab('stats')} className={`px-3 py-1 rounded text-xs font-bold ${subTab==='stats'?'bg-purple-600':'text-gray-500'}`}>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</button>
                            </div>
                        </div>

                        {subTab === 'settings' ? (
                            <div className="space-y-4">
                                <div className="flex justify-between items-center mb-2">
                                    <h2 className="text-xl font-bold text-white">‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥</h2>
                                    <button onClick={save} className="bg-blue-600 px-4 py-2 rounded-lg font-bold text-xs shadow-lg">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                                </div>
                                {/* –ë–ª–æ–∫ –Ω–∞—á–∏—Å–ª–µ–Ω–∏—è */}
                                <div className="bg-gray-800 p-4 rounded-xl border border-gray-700">
                                    <h3 className="text-pink-400 font-bold mb-3 text-xs uppercase">üéÅ –ù–∞—á–∏—Å–ª–∏—Ç—å</h3>
                                    <div className="grid grid-cols-3 gap-2">
                                        <div className="col-span-2"><input type="text" placeholder="ID" value={grantId} onChange={e => setGrantId(e.target.value)} className="w-full bg-gray-900 rounded p-2 text-white border border-gray-700 text-sm"/></div>
                                        <div><input type="number" placeholder="–°—É–º–º–∞" value={grantAmount} onChange={e => setGrantAmount(e.target.value)} className="w-full bg-gray-900 rounded p-2 text-white border border-gray-700 text-sm"/></div>
                                    </div>
                                    <button onClick={handleGrant} className="w-full mt-2 bg-pink-600 py-2 rounded-lg font-bold text-xs">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                                </div>
                                {/* –¶–µ–Ω—ã */}
                                <div className="bg-gray-800 p-4 rounded-xl border border-gray-700">
                                    <h3 className="text-blue-400 font-bold mb-3 text-xs uppercase">–¶–µ–Ω—ã</h3>
                                    <div className="grid grid-cols-2 gap-3">
                                        <div><label className="text-xs text-gray-500 block">–§–æ—Ç–æ</label><input type="number" value={localConfig.priceImage} onChange={e => handleChange('priceImage', Number(e.target.value))} className="w-full bg-gray-900 rounded p-2 text-white border border-gray-700"/></div>
                                        <div><label className="text-xs text-gray-500 block">–í–∏–¥–µ–æ</label><input type="number" value={localConfig.priceVideo} onChange={e => handleChange('priceVideo', Number(e.target.value))} className="w-full bg-gray-900 rounded p-2 text-white border border-gray-700"/></div>
                                    </div>
                                </div>
                            </div>
                        ) : (
                            <div className="text-center text-gray-500 mt-10">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</div>
                        )}
                    </div>
                );
            };

            const PayModal = () => {
                if (!payModalData) return null;
                return (
                    <div className="modal-overlay" onClick={() => setPayModalData(null)}>
                        <div className="modal-content" onClick={e => e.stopPropagation()}>
                            <h3 className="text-xl font-bold text-white mb-2">–û–ø–ª–∞—Ç–∞</h3>
                            <div className="text-blue-400 font-bold mb-4">{payModalData.name}</div>
                            <div className="text-2xl font-bold text-green-400 mb-4">{payModalData.price} ‚ÇΩ</div>
                            <a href={config.paymentLink} target="_blank" className="block w-full bg-blue-600 text-white py-3 rounded-xl font-bold mb-3">–ü–µ—Ä–µ–π—Ç–∏ –∫ –æ–ø–ª–∞—Ç–µ</a>
                            <button onClick={() => setPayModalData(null)} className="w-full text-gray-400 py-2">–û—Ç–º–µ–Ω–∞</button>
                        </div>
                    </div>
                );
            };

            const ShareModal = () => {
                if (!shareModalItem) return null;
                const { url, prompt } = shareModalItem;
                
                const nativeShare = () => {
                    if (navigator.share) {
                        navigator.share({ title: 'AI Art', text: prompt, url: url }).catch(console.error);
                    } else {
                        navigator.clipboard.writeText(url);
                        window.Telegram.WebApp.showAlert("–°—Å—ã–ª–∫–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞!");
                    }
                };

                return (
                    <div className="modal-overlay" onClick={() => setShareModalItem(null)}>
                        <div className="modal-content" onClick={e => e.stopPropagation()}>
                            <h3 className="text-xl font-bold text-white mb-4">–ü–æ–¥–µ–ª–∏—Ç—å—Å—è</h3>
                            <button onClick={nativeShare} className="w-full bg-blue-600 text-white py-3 rounded-xl font-bold mb-3 flex items-center justify-center">
                                <i className="fas fa-share-alt mr-2"></i> –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                            </button>
                            <button onClick={() => {navigator.clipboard.writeText(url); window.Telegram.WebApp.showAlert("–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!");}} className="w-full bg-gray-700 text-white py-3 rounded-xl font-bold mb-3 flex items-center justify-center">
                                <i className="fas fa-link mr-2"></i> –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Å—ã–ª–∫—É
                            </button>
                            <button onClick={() => setShareModalItem(null)} className="w-full text-gray-400 py-2">–ó–∞–∫—Ä—ã—Ç—å</button>
                        </div>
                    </div>
                );
            };

            const NavItem = ({ id, icon, label }) => (
                <button onClick={() => setActiveTab(id)} className={`flex flex-col items-center justify-center w-16 transition-all ${activeTab === id ? 'text-blue-500 scale-110' : 'text-gray-500'}`}>
                    <i className={`fas ${icon} text-xl mb-1`}></i>
                    <span className="text-[10px] font-medium">{label}</span>
                </button>
            );

            if (isLoading) return <div className="flex h-screen items-center justify-center text-blue-500"><i className="fas fa-circle-notch fa-spin text-2xl"></i></div>;

            return (
                <div className="min-h-screen bg-[#17212b]">
                    {activeTab === 'generate' && <TabGenerate />}
                    {activeTab === 'chat' && <TabChat />}
                    {activeTab === 'profile' && <TabProfile />}
                    {activeTab === 'admin' && <TabAdmin />}
                    
                    {/* –ù–ò–ñ–ù–ï–ï –ú–ï–ù–Æ FIXED */}
                    <div className="fixed bottom-0 left-0 right-0 bg-[#1c2936] border-t border-gray-800 pb-safe pt-2 px-6 flex justify-around z-50 h-[70px]">
                        <NavItem id="generate" icon="fa-wand-magic-sparkles" label="–ò–º–∏–¥–∂" />
                        <NavItem id="chat" icon="fa-comments" label="–ß–∞—Ç" />
                        <NavItem id="profile" icon="fa-user-circle" label="–ü—Ä–æ—Ñ–∏–ª—å" />
                    </div>

                    {payModalData && <PayModal />}
                    {shareModalItem && <ShareModal />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
